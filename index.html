<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Subscription Analyzer - Side by Side</title>
<style>
body { font-family: Arial, sans-serif; padding: 20px; }
.flex-container { display: flex; gap: 20px; align-items: flex-start; flex-wrap: wrap; }
table { border-collapse: collapse; width: 350px; min-width: 350px; table-layout: fixed; }
th, td { border: 1px solid #333; padding: 5px 10px; text-align: left; word-wrap: break-word; }
th { background-color: #f2f2f2; }
.header { background-color:#d9edf7; font-weight:bold; text-align:center; }
.subheader { background-color:#fcf8e3; font-weight:bold; text-align:center; }
.claimed { background-color:#d4edda; color:#155724; }
.missed { background-color:#f8d7da; color:#721c24; }
td.blank { background-color:#fff; }
</style>
</head>
<body>

<h2>Subscription Analyzer - Side by Side</h2>

<div class="flex-container" id="results"></div>

<script>
// Simulation Data
const intervals = [
  {
    pack_name: "Sub Pack 07",
    start_ts: new Date("2025-11-28 15:37"),
    subscriptions: 2,
    claims: [
      new Date("2025-11-28 19:16:13"),
      new Date("2025-11-29 12:05:04"),
      new Date("2025-12-01 20:58:21")
    ]
  },
  {
    pack_name: "Sub Pack 30",
    start_ts: new Date("2025-12-01 15:37"),
    subscriptions: 1,
    claims: [
      new Date("2025-12-01 20:58:21"),
      new Date("2025-12-02 15:37:31")
    ]
  },
  {
    pack_name: "Sub Pack 90",
    start_ts: new Date("2025-12-03 09:20"),
    subscriptions: 1,
    claims: [
      new Date("2025-12-03 12:10:00")
    ]
  }
];

function formatDate(date){
  const pad = n => n.toString().padStart(2,"0");
  return `${date.getFullYear()}-${pad(date.getMonth()+1)}-${pad(date.getDate())} ${pad(date.getHours())}:${pad(date.getMinutes())}`;
}

// Compute day windows for a subscription
function computeDayWindows(interval){
  const windows = [];
  let start = new Date(interval.start_ts);
  const total_days = interval.subscriptions * 7;
  for(let i=0;i<total_days;i++){
    let dayEnd = new Date(start);
    if(i===0){
      if(start.getHours()<8) dayEnd.setHours(8,0,0,0);
      else { dayEnd.setDate(dayEnd.getDate()+1); dayEnd.setHours(8,0,0,0);}
    } else {
      dayEnd.setDate(dayEnd.getDate()+1);
      dayEnd.setHours(8,0,0,0);
    }
    windows.push({day_label:`Day${i+1}`, start:new Date(start), end:dayEnd});
    start = new Date(dayEnd);
  }
  return windows;
}

// Map claims to days
function mapClaims(interval, totalMaxDays){
  const windows = computeDayWindows(interval);
  const results = [];
  for(let i=0;i<totalMaxDays;i++){
    const w = windows[i] || {day_label:`Day${i+1}`, start:null, end:null};
    let status = "Missed";
    if(w.start){
      for(let c of interval.claims){
        if(c >= w.start && c < w.end){
          status = formatDate(c);
          break;
        }
      }
    }
    results.push({day_label:w.day_label, start:w.start, end:w.end, status:status});
  }
  return results;
}

// Create table for a subscription
function createTable(interval, dayResults){
  const table = document.createElement("table");

  // Header
  const header = table.insertRow();
  const th = document.createElement("th"); 
  th.colSpan=2; 
  th.className="header"; 
  th.innerText=interval.pack_name; 
  header.appendChild(th);

  // Total days row (with blank column)
  const totalRow = table.insertRow();
  let cell1 = totalRow.insertCell(); 
  cell1.innerText = `Total: ${interval.subscriptions * 7} day${interval.subscriptions*7>1?'s':''}`;
  cell1.style.backgroundColor="#d1ecf1"; cell1.style.fontWeight="bold";
  totalRow.insertCell(); // blank column

  // Start/end row
  const seRow = table.insertRow();
  const endDate = dayResults.find(d=>d.start)?.end || new Date(interval.start_ts.getTime() + interval.subscriptions*7*24*60*60*1000);
  seRow.insertCell().innerText = `Start: ${formatDate(interval.start_ts)} | End: ${formatDate(endDate)}`;
  seRow.insertCell(); // blank column

  // Subheader
  const subHeader = table.insertRow();
  subHeader.insertCell().innerText = "Day | Day Range | Status";
  subHeader.insertCell(); // blank column
  subHeader.className="subheader";

  // Day rows
  dayResults.forEach(d=>{
    const row = table.insertRow();
    const cell = row.insertCell();
    if(d.start && d.end){
      cell.innerText = `${d.day_label} | ${formatDate(d.start)} â†’ ${formatDate(d.end)} | ${d.status}`;
      if(d.status !== "Missed") cell.className="claimed";
      else cell.className="missed";
    } else {
      cell.innerText = `${d.day_label} | - | ${d.status}`;
      cell.className="missed";
    }
    row.insertCell().className="blank"; // blank column
  });

  return table;
}

// Determine maximum number of days across all subscriptions
const totalMaxDays = Math.max(...intervals.map(i=>i.subscriptions*7));

const resultsDiv = document.getElementById("results");
intervals.forEach(interval=>{
  const dayResults = mapClaims(interval, totalMaxDays);
  resultsDiv.appendChild(createTable(interval, dayResults));
});
</script>

</body>
</html>
